
"use strict";angular.module("isteven-multi-select",["ng"]).directive("istevenMultiSelect",["$sce","$timeout","$templateCache",function(b,c,a){return{restrict:"AE",scope:{inputModel:"=",outputModel:"=",isDisabled:"=",onClear:"&",onClose:"&",onSearchChange:"&",onItemClick:"&",onOpen:"&",onReset:"&",onSelectAll:"&",onSelectNone:"&",translation:"="},templateUrl:"isteven-multi-select.htm",link:function(r,e,q){r.backUp=[];r.varButtonLabel="";r.spacingProperty="";r.indexProperty="";r.orientationH=false;r.orientationV=true;r.filteredModel=[];r.inputLabel={labelFilter:""};r.tabIndex=0;r.lang={};r.helperStatus={all:true,none:true,reset:true,filter:true};var j=0,n=[],l=0,p="",f=false,k=[],t=[],d=0,m=null;r.clearClicked=function(v){r.inputLabel.labelFilter="";r.updateFilter();r.select("clear",v)};r.numberToArray=function(v){return new Array(v)};r.searchChanged=function(){if(r.inputLabel.labelFilter.length<d&&r.inputLabel.labelFilter.length>0){return false}r.updateFilter()};r.updateFilter=function(){r.filteredModel=[];var x=0;if(typeof r.inputModel==="undefined"){return false}for(x=r.inputModel.length-1;x>=0;x--){if(typeof r.inputModel[x][q.groupProperty]!=="undefined"&&r.inputModel[x][q.groupProperty]===false){r.filteredModel.push(r.inputModel[x])}var v=false;if(typeof r.inputModel[x][q.groupProperty]==="undefined"){if(typeof q.searchProperty!=="undefined"&&q.searchProperty!==""){for(var w in r.inputModel[x]){if(typeof r.inputModel[x][w]!=="boolean"&&String(r.inputModel[x][w]).toUpperCase().indexOf(r.inputLabel.labelFilter.toUpperCase())>=0&&q.searchProperty.indexOf(w)>-1){v=true;break}}}else{for(var w in r.inputModel[x]){if(typeof r.inputModel[x][w]!=="boolean"&&String(r.inputModel[x][w]).toUpperCase().indexOf(r.inputLabel.labelFilter.toUpperCase())>=0){v=true;break}}}if(v===true){r.filteredModel.push(r.inputModel[x])}}if(typeof r.inputModel[x][q.groupProperty]!=="undefined"&&r.inputModel[x][q.groupProperty]===true){if(typeof r.filteredModel[r.filteredModel.length-1][q.groupProperty]!=="undefined"&&r.filteredModel[r.filteredModel.length-1][q.groupProperty]===false){r.filteredModel.pop()}else{r.filteredModel.push(r.inputModel[x])}}}r.filteredModel.reverse();c(function(){r.getFormElements();if(r.inputLabel.labelFilter.length>d){var y=[];angular.forEach(r.filteredModel,function(C,B){if(typeof C!=="undefined"){if(typeof C[q.groupProperty]==="undefined"){var z=angular.copy(C);var A=y.push(z);delete y[A-1][r.indexProperty];delete y[A-1][r.spacingProperty]}}});r.onSearchChange({data:{keyword:r.inputLabel.labelFilter,result:y}})}},0)};r.getFormElements=function(){t=[];var x=[],v=[],y=[],z=[];if(r.helperStatus.all||r.helperStatus.none||r.helperStatus.reset){x=e.children().children().next().children().children()[0].getElementsByTagName("button");if(r.helperStatus.filter){v=e.children().children().next().children().children().next()[0].getElementsByTagName("input");z=e.children().children().next().children().children().next()[0].getElementsByTagName("button")}}else{if(r.helperStatus.filter){v=e.children().children().next().children().children()[0].getElementsByTagName("input");z=e.children().children().next().children().children()[0].getElementsByTagName("button")}}if(!r.helperStatus.all&&!r.helperStatus.none&&!r.helperStatus.reset&&!r.helperStatus.filter){y=e.children().children().next()[0].getElementsByTagName("input")}else{y=e.children().children().next().children().next()[0].getElementsByTagName("input")}for(var w=0;w<x.length;w++){t.push(x[w])}for(var w=0;w<v.length;w++){t.push(v[w])}for(var w=0;w<z.length;w++){t.push(z[w])}for(var w=0;w<y.length;w++){t.push(y[w])}};r.isGroupMarker=function(w,v){if(typeof w[q.groupProperty]!=="undefined"&&w[q.groupProperty]===v){return true}return false};r.removeGroupEndMarker=function(v){if(typeof v[q.groupProperty]!=="undefined"&&v[q.groupProperty]===false){return false}return true};r.syncItems=function(H,D,v){D.preventDefault();D.stopPropagation();if(typeof q.disableProperty!=="undefined"&&H[q.disableProperty]===true){return false}if(typeof q.isDisabled!=="undefined"&&r.isDisabled===true){return false}if(typeof H[q.groupProperty]!=="undefined"&&H[q.groupProperty]===false){return false}var B=r.filteredModel.indexOf(H);if(typeof H[q.groupProperty]!=="undefined"&&H[q.groupProperty]===true){if(typeof q.selectionMode!=="undefined"&&q.selectionMode.toUpperCase()==="SINGLE"){return false}var z,y,x;var G=0;var A=r.filteredModel.length-1;var F=[];var w=0;for(z=B;z<r.filteredModel.length;z++){if(w===0&&z>B){break}if(typeof r.filteredModel[z][q.groupProperty]!=="undefined"&&r.filteredModel[z][q.groupProperty]===true){if(F.length===0){G=z+1}w=w+1}else{if(typeof r.filteredModel[z][q.groupProperty]!=="undefined"&&r.filteredModel[z][q.groupProperty]===false){w=w-1;if(F.length>0&&w===0){var E=true;A=z;for(y=0;y<F.length;y++){if(typeof F[y][r.tickProperty]!=="undefined"&&F[y][r.tickProperty]===false){E=false;break}}if(E===true){for(y=G;y<=A;y++){if(typeof r.filteredModel[y][q.groupProperty]==="undefined"){if(typeof q.disableProperty==="undefined"){r.filteredModel[y][r.tickProperty]=false;C=r.filteredModel[y][r.indexProperty];r.inputModel[C][r.tickProperty]=false}else{if(r.filteredModel[y][q.disableProperty]!==true){r.filteredModel[y][r.tickProperty]=false;C=r.filteredModel[y][r.indexProperty];r.inputModel[C][r.tickProperty]=false}}}}}else{for(y=G;y<=A;y++){if(typeof r.filteredModel[y][q.groupProperty]==="undefined"){if(typeof q.disableProperty==="undefined"){r.filteredModel[y][r.tickProperty]=true;C=r.filteredModel[y][r.indexProperty];r.inputModel[C][r.tickProperty]=true}else{if(r.filteredModel[y][q.disableProperty]!==true){r.filteredModel[y][r.tickProperty]=true;C=r.filteredModel[y][r.indexProperty];r.inputModel[C][r.tickProperty]=true}}}}}}}else{F.push(r.filteredModel[z])}}}}else{if(typeof q.selectionMode!=="undefined"&&q.selectionMode.toUpperCase()==="SINGLE"){for(z=0;z<r.filteredModel.length;z++){r.filteredModel[z][r.tickProperty]=false}for(z=0;z<r.inputModel.length;z++){r.inputModel[z][r.tickProperty]=false}r.filteredModel[B][r.tickProperty]=true}else{r.filteredModel[B][r.tickProperty]=!r.filteredModel[B][r.tickProperty]}var C=r.filteredModel[B][r.indexProperty];r.inputModel[C][r.tickProperty]=r.filteredModel[B][r.tickProperty]}m=angular.copy(H);if(m!==null){c(function(){delete m[r.indexProperty];delete m[r.spacingProperty];r.onItemClick({data:m});m=null},0)}r.refreshOutputModel();r.refreshButton();j=r.tabIndex;r.tabIndex=v+l;D.target.focus();r.removeFocusStyle(j);r.setFocusStyle(r.tabIndex);if(typeof q.selectionMode!=="undefined"&&q.selectionMode.toUpperCase()==="SINGLE"){r.toggleCheckboxes(D)}};r.refreshOutputModel=function(){r.outputModel=[];var w=[],v={};if(typeof q.outputProperties!=="undefined"){w=q.outputProperties.split(" ");angular.forEach(r.inputModel,function(z,y){if(typeof z!=="undefined"&&typeof z[q.groupProperty]==="undefined"&&z[r.tickProperty]===true){v={};angular.forEach(z,function(A,B){if(w.indexOf(B)>-1){v[B]=A}});var x=r.outputModel.push(v);delete r.outputModel[x-1][r.indexProperty];delete r.outputModel[x-1][r.spacingProperty]}})}else{angular.forEach(r.inputModel,function(A,z){if(typeof A!=="undefined"&&typeof A[q.groupProperty]==="undefined"&&A[r.tickProperty]===true){var x=angular.copy(A);var y=r.outputModel.push(x);delete r.outputModel[y-1][r.indexProperty];delete r.outputModel[y-1][r.spacingProperty]}})}};r.refreshButton=function(){r.varButtonLabel="";var w=0;if(r.outputModel.length===0){r.varButtonLabel=r.lang.nothingSelected}else{var v=r.outputModel.length;if(typeof q.maxLabels!=="undefined"&&q.maxLabels!==""){v=q.maxLabels}if(r.outputModel.length>v){r.more=true}else{r.more=false}angular.forEach(r.inputModel,function(y,x){if(typeof y!=="undefined"&&y[q.tickProperty]===true){if(w<v){r.varButtonLabel+=(r.varButtonLabel.length>0?'</div>, <div class="buttonLabel">':'<div class="buttonLabel">')+r.writeLabel(y,"buttonLabel")}w++}});if(r.more===true){if(v>0){r.varButtonLabel+=", ... "}r.varButtonLabel+="("+r.outputModel.length+")"}}r.varButtonLabel=b.trustAsHtml(r.varButtonLabel+'<span class="caret"></span>')};r.itemIsDisabled=function(v){if(typeof q.disableProperty!=="undefined"&&v[q.disableProperty]===true){return true}else{if(r.isDisabled===true){return true}else{return false}}};r.writeLabel=function(y,x){var v=q[x].split(" ");var w="";angular.forEach(v,function(A,z){y[A]&&(w+="&nbsp;"+A.split(".").reduce(function(B,C){return B[C]},y))});if(x.toUpperCase()==="BUTTONLABEL"){return w}return b.trustAsHtml(w)};r.toggleCheckboxes=function(x){var w=e.children()[0];angular.element(document).off("click",r.externalClickListener);angular.element(document).off("keydown",r.keyboardListener);if(angular.element(p).hasClass("show")){angular.element(p).removeClass("show");angular.element(w).removeClass("buttonClicked");angular.element(document).off("click",r.externalClickListener);angular.element(document).off("keydown",r.keyboardListener);r.removeFocusStyle(r.tabIndex);if(typeof t[r.tabIndex]!=="undefined"){t[r.tabIndex].blur()}c(function(){r.onClose()},0);e.children().children()[0].focus()}else{r.inputLabel.labelFilter="";r.updateFilter();n=[];l=0;angular.element(p).addClass("show");angular.element(w).addClass("buttonClicked");angular.element(document).on("click",r.externalClickListener);angular.element(document).on("keydown",r.keyboardListener);r.getFormElements();r.tabIndex=0;var y=angular.element(e[0].querySelector(".helperContainer"))[0];if(typeof y!=="undefined"){for(var v=0;v<y.getElementsByTagName("BUTTON").length;v++){n[v]=y.getElementsByTagName("BUTTON")[v]}l=n.length+y.getElementsByTagName("INPUT").length}if(e[0].querySelector(".inputFilter")){e[0].querySelector(".inputFilter").focus();r.tabIndex=r.tabIndex+l-2;angular.element(e).children()[0].blur()}else{if(!r.isDisabled){r.tabIndex=r.tabIndex+l;if(r.inputModel.length>0){t[r.tabIndex].focus();r.setFocusStyle(r.tabIndex);angular.element(e).children()[0].blur()}}}r.onOpen()}};r.externalClickListener=function(x){var w=e.find(x.target.tagName);for(var v=0;v<w.length;v++){if(x.target==w[v]){return}}angular.element(p.previousSibling).removeClass("buttonClicked");angular.element(p).removeClass("show");angular.element(document).off("click",r.externalClickListener);angular.element(document).off("keydown",r.keyboardListener);c(function(){r.onClose()},0);e.children().children()[0].focus()};r.select=function(w,x){var v=n.indexOf(x.target);r.tabIndex=v;switch(w.toUpperCase()){case"ALL":angular.forEach(r.filteredModel,function(z,y){if(typeof z!=="undefined"&&z[q.disableProperty]!==true){if(typeof z[q.groupProperty]==="undefined"){z[r.tickProperty]=true}}});r.refreshOutputModel();r.refreshButton();r.onSelectAll();break;case"NONE":angular.forEach(r.filteredModel,function(z,y){if(typeof z!=="undefined"&&z[q.disableProperty]!==true){if(typeof z[q.groupProperty]==="undefined"){z[r.tickProperty]=false}}});r.refreshOutputModel();r.refreshButton();r.onSelectNone();break;case"RESET":angular.forEach(r.filteredModel,function(A,z){if(typeof A[q.groupProperty]==="undefined"&&typeof A!=="undefined"&&A[q.disableProperty]!==true){var y=A[r.indexProperty];A[r.tickProperty]=r.backUp[y][r.tickProperty]}});r.refreshOutputModel();r.refreshButton();r.onReset();break;case"CLEAR":r.tabIndex=r.tabIndex+1;r.onClear();break;case"FILTER":r.tabIndex=n.length-1;break;default:}};function o(y){var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";var v="";for(var x=0;x<y;x++){v+=w.charAt(Math.floor(Math.random()*w.length))}return v}r.prepareGrouping=function(){var v=0;angular.forEach(r.filteredModel,function(x,w){x[r.spacingProperty]=v;if(x[q.groupProperty]===true){v+=2}else{if(x[q.groupProperty]===false){v-=2}}})};r.prepareIndex=function(){var v=0;angular.forEach(r.filteredModel,function(x,w){x[r.indexProperty]=v;v++})};r.keyboardListener=function(y){var w=y.keyCode?y.keyCode:y.which;var x=false;if(w===27){y.preventDefault();y.stopPropagation();r.toggleCheckboxes(y)}else{if(w===40||w===39||(!y.shiftKey&&w==9)){x=true;j=r.tabIndex;r.tabIndex++;if(r.tabIndex>t.length-1){r.tabIndex=0;j=t.length-1}while(t[r.tabIndex].disabled===true){r.tabIndex++;if(r.tabIndex>t.length-1){r.tabIndex=0}if(r.tabIndex===j){break}}}else{if(w===38||w===37||(y.shiftKey&&w==9)){x=true;j=r.tabIndex;r.tabIndex--;if(r.tabIndex<0){r.tabIndex=t.length-1;j=0}while(t[r.tabIndex].disabled===true){r.tabIndex--;if(r.tabIndex===j){break}if(r.tabIndex<0){r.tabIndex=t.length-1}}}}}if(x===true){y.preventDefault();t[r.tabIndex].focus();var v=document.activeElement;if(v.type.toUpperCase()==="CHECKBOX"){r.setFocusStyle(r.tabIndex);r.removeFocusStyle(j)}else{r.removeFocusStyle(j);r.removeFocusStyle(l);r.removeFocusStyle(t.length-1)}}x=false};r.setFocusStyle=function(v){angular.element(t[v]).parent().parent().parent().addClass("multiSelectFocus")};r.removeFocusStyle=function(v){angular.element(t[v]).parent().parent().parent().removeClass("multiSelectFocus")};r.groupProperty=q.groupProperty;r.tickProperty=q.tickProperty;r.directiveId=q.directiveId;var s=o(5);r.indexProperty="idx_"+s;r.spacingProperty="spc_"+s;if(typeof q.orientation!=="undefined"){if(q.orientation.toUpperCase()==="HORIZONTAL"){r.orientationH=true;r.orientationV=false}else{r.orientationH=false;r.orientationV=true}}p=e.children().children().next()[0];if(typeof q.maxHeight!=="undefined"){var u=e.children().children().children()[0];angular.element(u).attr("style","height:"+q.maxHeight+"; overflow-y:scroll;")}for(var i in r.helperStatus){if(r.helperStatus.hasOwnProperty(i)){if(typeof q.helperElements!=="undefined"&&q.helperElements.toUpperCase().indexOf(i.toUpperCase())===-1){r.helperStatus[i]=false}}}if(typeof q.selectionMode!=="undefined"&&q.selectionMode.toUpperCase()==="SINGLE"){r.helperStatus.all=false;r.helperStatus.none=false}r.icon={};r.icon.selectAll="&#10003;";r.icon.selectNone="&times;";r.icon.reset="&#8630;";r.icon.tickMark="&#10003;";if(typeof q.translation!=="undefined"){r.lang.selectAll=b.trustAsHtml(r.icon.selectAll+"&nbsp;&nbsp;"+r.translation.selectAll);r.lang.selectNone=b.trustAsHtml(r.icon.selectNone+"&nbsp;&nbsp;"+r.translation.selectNone);r.lang.reset=b.trustAsHtml(r.icon.reset+"&nbsp;&nbsp;"+r.translation.reset);r.lang.search=r.translation.search;r.lang.nothingSelected=b.trustAsHtml(r.translation.nothingSelected)}else{r.lang.selectAll=b.trustAsHtml(r.icon.selectAll+"&nbsp;&nbsp;Select All");r.lang.selectNone=b.trustAsHtml(r.icon.selectNone+"&nbsp;&nbsp;Select None");r.lang.reset=b.trustAsHtml(r.icon.reset+"&nbsp;&nbsp;Reset");r.lang.search="Search...";r.lang.nothingSelected="None Selected"}r.icon.tickMark=b.trustAsHtml(r.icon.tickMark);if(typeof q.MinSearchLength!=="undefined"&&parseInt(q.MinSearchLength)>0){d=Math.floor(parseInt(q.MinSearchLength))}r.$watch("inputModel",function(v){if(v){r.refreshOutputModel();r.refreshButton()}},true);r.$watch("inputModel",function(v){if(v){r.backUp=angular.copy(r.inputModel);r.updateFilter();r.prepareGrouping();r.prepareIndex();r.refreshOutputModel();r.refreshButton()}});r.$watch("isDisabled",function(v){r.isDisabled=v});var g=function(v){r.$apply(function(){r.scrolled=false})};angular.element(document).bind("touchstart",g);var h=function(v){r.$apply(function(){r.scrolled=true})};angular.element(document).bind("touchmove",h);r.$on("$destroy",function(){angular.element(document).unbind("touchstart",g);angular.element(document).unbind("touchmove",h)})}}}]).run(["$templateCache",function(a){var b='<span class="multiSelect inlineBlock"><button id="{{directiveId}}" type="button"ng-click="toggleCheckboxes( $event ); refreshSelectedItems(); refreshButton(); prepareGrouping; prepareIndex();"ng-bind-html="varButtonLabel"ng-disabled="disable-button"></button><div class="checkboxLayer"><div class="helperContainer" ng-if="helperStatus.filter || helperStatus.all || helperStatus.none || helperStatus.reset "><div class="line" ng-if="helperStatus.all || helperStatus.none || helperStatus.reset "><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.all"ng-click="select( \'all\', $event );"ng-bind-html="lang.selectAll"></button><button type="button" class="helperButton"ng-disabled="isDisabled"ng-if="helperStatus.none"ng-click="select( \'none\', $event );"ng-bind-html="lang.selectNone"></button><button type="button" class="helperButton reset"ng-disabled="isDisabled"ng-if="helperStatus.reset"ng-click="select( \'reset\', $event );"ng-bind-html="lang.reset"></button></div><div class="line" style="position:relative" ng-if="helperStatus.filter"><input placeholder="{{lang.search}}" type="text"ng-click="select( \'filter\', $event )" ng-model="inputLabel.labelFilter" ng-change="searchChanged()" class="inputFilter"/><button type="button" class="clearButton" ng-click="clearClicked( $event )" >×</button> </div> </div> <div class="checkBoxContainer"><div ng-repeat="item in filteredModel | filter:removeGroupEndMarker" class="multiSelectItem"ng-class="{selected: item[ tickProperty ], horizontal: orientationH, vertical: orientationV, multiSelectGroup:item[ groupProperty ], disabled:itemIsDisabled( item )}"ng-click="syncItems( item, $event, $index );" ng-mouseleave="removeFocusStyle( tabIndex );"> <div class="acol" ng-if="item[ spacingProperty ] > 0" ng-repeat="i in numberToArray( item[ spacingProperty ] ) track by $index"></div>  <div class="acol"><label><input class="checkbox focusable" type="checkbox" ng-disabled="itemIsDisabled( item )" ng-checked="item[ tickProperty ]" ng-click="syncItems( item, $event, $index )" /><span ng-class="{disabled:itemIsDisabled( item )}" ng-bind-html="writeLabel( item, \'itemLabel\' )"></span></label></div><span class="tickMark" ng-if="item[ groupProperty ] !== true && item[ tickProperty ] === true" ng-bind-html="icon.tickMark"></span></div></div></div></span>';a.put("isteven-multi-select.htm",b)}]);